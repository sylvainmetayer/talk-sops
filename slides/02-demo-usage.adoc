=== Chiffrement

[source, shell]
----
sops -e --age age14trf5fvhkppd8suunru9mg7dkk9r6ndzwc7tnw45yufs2j9h3u9qqwttxu \
plaintext.yaml > secrets.yaml
----

=== Chiffrement partiel

[source, shell]
----
sops --encrypt --encrypted-regex '^(data|stringData)$' k8s-secrets.yaml
sops -e --encrypted-suffix MY_KEY --age \
age14trf5fvhkppd8suunru9mg7dkk9r6ndzwc7tnw45yufs2j9h3u9qqwttxu \
plaintext.yaml > secrets.yaml
----

=== Déchiffrement

[%linenum,shell]
----
export SOPS_AGE_KEY_FILE=/path/to/my/private/key
sops -d secrets.yaml
----

=== Gestion des destinataires

.With sops cli
[source, shell]
----
sops -r -i --add-age PUB_KEY,PUB_KEY2 secrets.yaml
sops -r -i --rm-age PUB_KEY secrets.yaml
----

[.fragment]
--
..sops.yaml
[%linenums,yaml]
----
include::../code/exemple.sops.yaml[]
----
--
[.notes]
****
Attention, si permission de voir = permission d'éditer.
****

[.demo_background]
== Démo

`./demo.sh`

[.notes]
****
~5min
****

== Pas très lisible tout ça ?

TODO diff en clair

- https://github.com/getsops/sops/issues/959
- https://github.com/getsops/sops/discussions/1159


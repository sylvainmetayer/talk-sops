[.columns.is-vcentered]
== SOPS

[.column]
--
image::logo_sops.png[]

link:https://github.com/getsops/sops[Documentation & Installation]
--

[.column]
--
Installation possible avec link:https://asdf.talks.sylvain.dev/[asdf]
--

[.notes]
****
SOPS permet de chiffrer des données dans un fichier à l'aide de plusieurs méthodes de chiffrements (SOPS, KMS...).
Alternative viable en cas de non-dispo de vault et/ou autre.
Facilité d'utilisation pour GitOps

CNCF Sandbox depuis May 17, 2023 : Gouvernance
****

=== Structure d'un fichier

[%linenums,yaml,highlight=1|7..16|17..21]
----
include::../code/01-sops-file.yaml[]
----

[.notes]
****
- TODO Plus d'info sur clé sops.mac
- Clés fichier en clair, contenu chiffré
- Metadata sops incluse dans le fichier, ainsi que les destinataires.
- La clé de déchiffrement est stockée dans chacun des blocs des destinaires, chiffrée avec la clé publique de l'utilisateur
- Tant qu'un des destinataires a accès au fichier, il est possible de lire et modifier le contenu.
- Autres formats possibles, mais utilisé dans conf pour simplicité : INI JSON ...
- Pour ceux qui veulent savoir le mot de passe, c'est "SuperLongAndSecurePassword"
****

=== Et ça ressemble à quoi une clé de déchiffrement ?

[%linenums,bash]
----
$ cat file.age
-----BEGIN AGE ENCRYPTED FILE-----
YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSArU3JTUi95ZW1ZS0FsRUt6
dklXOWRuY0k3clRGc2hzcW90UCtvTTRJazFjCkxMNEJYYzE4c1dMYW8wWDNwSk12
clhCK25RbWZzc1laT0Nib1dFVnIyc0EKLS0tIHJCS3Z1Y0ZMWFp1RzdkSG8reE55
NFhQR2VWTFcwMkhoMEpjOUxWbXVCdkEKs+47mS6jYpm5LYlq+NEIOwpqvyLtfsyS
FmyNQh3Ob1CL/1iNaCQsZeFV/k763AIJ4JT6M2hdiQCoVNNJUBwrXw==
-----END AGE ENCRYPTED FILE-----
$ age --decrypt -i ~/.age.key -o /dev/stdout file.age
��te`^��_�V�hMa�t5i_.P�ғ�be^�m
----

[.columns.is-vcentered]
=== Méthodes de chiffrement

[.column]
--
Chiffrement avec link:https://github.com/FiloSottile/age[age]
--

[.column]
--
Exemple de clé age

[source,bash]
----
$ age-keygen
# created: 2024-03-08T15:17:28+01:00
# public key: age14trf5fvhkppd8suunru9mg7dkk9r6ndzwc7tnw45yufs2j9h3u9qqwttxu
AGE-SECRET-KEY-1RM9QASYLNVDQ48HDY5ST7RUXX4LFWPR6PTUHUFG7N5RYUG0PNLLSG6D70R
----
--

[.notes]
****
- Usage simple
- Non centralisé
- Plusieurs méthodes de chiffrement : AWS KMS, Azure, GCP, PGP
- Ce qui est utilisé pour cette présentation
****

